{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "file-input",
  "type": "registry:component",
  "title": "File Input",
  "description": "A file input component with drag and drop support, file previews, and validation",
  "dependencies": [
    "zod",
    "@phosphor-icons/react"
  ],
  "registryDependencies": [
    "button"
  ],
  "files": [
    {
      "path": "delta/forms/file-input.tsx",
      "content": "'use client';\n\nimport * as React from 'react';\nimport { cn } from '@/lib/utils';\nimport {\n  CloudArrowUp,\n  X,\n  File,\n  Image,\n  FileText,\n  FileVideo,\n  FileAudio,\n} from '@phosphor-icons/react';\nimport type { z } from 'zod';\nimport { Button } from '@/components/ui/button';\n\nexport interface FileInputProps {\n  /** The label for the file input field */\n  label: string;\n  /** The name of the file input field (used for form submission) */\n  name: string;\n  /** Optional description text to display below the label */\n  description?: string;\n  /** Optional hint text to display below the file input */\n  hint?: string;\n  /** Error message to display (typically from Zod validation) */\n  error?: string;\n  /** Whether the field is required */\n  required?: boolean;\n  /** Whether the field is in a loading/pending state */\n  pending?: boolean;\n  /** Container className for the entire component */\n  containerClassName?: string;\n  /** Dropzone className for the file drop area */\n  dropzoneClassName?: string;\n  /** Label className for customizing the label */\n  labelClassName?: string;\n  /** Label variant - 'default' or 'muted' */\n  labelVariant?: 'default' | 'muted';\n  /** Input variant - 'default' or 'pill' */\n  variant?: 'default' | 'pill';\n  /** Whether to show a colored border (only applies to pill variant) */\n  coloredBorder?: boolean;\n  /** Zod schema for validation (optional - can be handled at the form level) */\n  schema?: z.ZodType<File | File[]>;\n  /** Callback when validation occurs */\n  onValidate?: (isValid: boolean, files: File | File[], error?: string) => void;\n  /** Callback when files are selected */\n  onFilesSelected?: (files: File[]) => void;\n  /** ID for the file input */\n  id?: string;\n  /** Whether the file input is disabled */\n  disabled?: boolean;\n  /** Whether to accept multiple files */\n  multiple?: boolean;\n  /** Accepted file types (e.g., \"image/*\", \".pdf\", etc.) */\n  accept?: string;\n  /** Maximum file size in bytes */\n  maxSize?: number;\n  /** Maximum number of files (only applies when multiple is true) */\n  maxFiles?: number;\n  /** Custom text for the dropzone */\n  dropzoneText?: string;\n  /** Whether to show file previews */\n  showPreviews?: boolean;\n  /** Whether to show file type icons */\n  showIcons?: boolean;\n}\n\n/**\n * FileInput component that integrates with Zod validation\n */\nexport function FileInput({\n  label,\n  name,\n  description,\n  hint,\n  error,\n  required = false,\n  pending = false,\n  containerClassName,\n  dropzoneClassName,\n  labelClassName,\n  labelVariant = 'default',\n  variant = 'default',\n  coloredBorder = false,\n  schema,\n  onValidate,\n  onFilesSelected,\n  id = name,\n  disabled = false,\n  multiple = false,\n  accept,\n  maxSize,\n  maxFiles = 5,\n  dropzoneText,\n  showPreviews = true,\n  showIcons = true,\n}: FileInputProps) {\n  const [localError, setLocalError] = React.useState<string | undefined>(error);\n  const [files, setFiles] = React.useState<File[]>([]);\n  const [isDragging, setIsDragging] = React.useState(false);\n  const fileInputRef = React.useRef<HTMLInputElement>(null);\n  const hasError = !!localError || !!error;\n  const errorId = `error-${id}`;\n  const hintId = `hint-${id}`;\n\n  // Update local error when prop changes\n  React.useEffect(() => {\n    setLocalError(error);\n  }, [error]);\n\n  // Handle validation with the provided schema\n  const validateFiles = React.useCallback(\n    (files: File[]) => {\n      if (!schema) return;\n\n      try {\n        const result = schema.safeParse(multiple ? files : files[0]);\n        if (!result.success) {\n          const errorMessage =\n            result.error.errors[0]?.message || 'Invalid file(s)';\n          setLocalError(errorMessage);\n          onValidate?.(false, multiple ? files : files[0], errorMessage);\n        } else {\n          setLocalError(undefined);\n          onValidate?.(true, multiple ? files : files[0]);\n        }\n      } catch (err) {\n        setLocalError('Validation error');\n        onValidate?.(false, multiple ? files : files[0], 'Validation error');\n      }\n    },\n    [schema, onValidate, multiple],\n  );\n\n  // Handle file selection\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!e.target.files?.length) return;\n\n    const selectedFiles = Array.from(e.target.files);\n\n    // Validate file size if maxSize is provided\n    if (maxSize) {\n      const oversizedFiles = selectedFiles.filter(\n        (file) => file.size > maxSize,\n      );\n      if (oversizedFiles.length > 0) {\n        const fileNames = oversizedFiles.map((f) => f.name).join(', ');\n        const errorMsg = `File${oversizedFiles.length > 1 ? 's' : ''} too large: ${fileNames}`;\n        setLocalError(errorMsg);\n        return;\n      }\n    }\n\n    // Validate number of files if multiple is true\n    if (multiple && maxFiles && selectedFiles.length > maxFiles) {\n      setLocalError(`You can only upload up to ${maxFiles} files`);\n      return;\n    }\n\n    // Update files state\n    const newFiles = multiple ? [...files, ...selectedFiles] : selectedFiles;\n\n    // Check if we're exceeding maxFiles after combining with existing files\n    if (multiple && maxFiles && newFiles.length > maxFiles) {\n      setLocalError(`You can only upload up to ${maxFiles} files`);\n      return;\n    }\n\n    setFiles(newFiles);\n\n    // Validate with schema if provided\n    if (schema) {\n      validateFiles(newFiles);\n    }\n\n    // Call onFilesSelected callback\n    onFilesSelected?.(newFiles);\n\n    // Reset the input value to allow selecting the same file again\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // Handle drag events\n  const handleDragEnter = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!disabled && !pending) {\n      setIsDragging(true);\n    }\n  };\n\n  const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n  };\n\n  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!disabled && !pending) {\n      e.dataTransfer.dropEffect = 'copy';\n      setIsDragging(true);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n\n    if (disabled || pending) return;\n\n    const droppedFiles = Array.from(e.dataTransfer.files);\n\n    // Validate file types if accept is provided\n    if (accept) {\n      const acceptedTypes = accept.split(',').map((type) => type.trim());\n      const invalidFiles = droppedFiles.filter((file) => {\n        return !acceptedTypes.some((type) => {\n          if (type.startsWith('.')) {\n            // Check file extension\n            return file.name.toLowerCase().endsWith(type.toLowerCase());\n          } else if (type.includes('/*')) {\n            // Check file type category (e.g., \"image/*\")\n            const category = type.split('/')[0];\n            return file.type.startsWith(`${category}/`);\n          } else {\n            // Check exact mime type\n            return file.type === type;\n          }\n        });\n      });\n\n      if (invalidFiles.length > 0) {\n        const fileNames = invalidFiles.map((f) => f.name).join(', ');\n        const errorMsg = `Invalid file type${invalidFiles.length > 1 ? 's' : ''}: ${fileNames}`;\n        setLocalError(errorMsg);\n        return;\n      }\n    }\n\n    // Validate file size if maxSize is provided\n    if (maxSize) {\n      const oversizedFiles = droppedFiles.filter((file) => file.size > maxSize);\n      if (oversizedFiles.length > 0) {\n        const fileNames = oversizedFiles.map((f) => f.name).join(', ');\n        const errorMsg = `File${oversizedFiles.length > 1 ? 's' : ''} too large: ${fileNames}`;\n        setLocalError(errorMsg);\n        return;\n      }\n    }\n\n    // Validate number of files if multiple is true\n    const newFiles = multiple ? [...files, ...droppedFiles] : droppedFiles;\n\n    if (multiple && maxFiles && newFiles.length > maxFiles) {\n      setLocalError(`You can only upload up to ${maxFiles} files`);\n      return;\n    }\n\n    setFiles(newFiles);\n\n    // Validate with schema if provided\n    if (schema) {\n      validateFiles(newFiles);\n    }\n\n    // Call onFilesSelected callback\n    onFilesSelected?.(newFiles);\n  };\n\n  // Handle file removal\n  const removeFile = (index: number) => {\n    const newFiles = [...files];\n    newFiles.splice(index, 1);\n    setFiles(newFiles);\n\n    // Validate with schema if provided\n    if (schema) {\n      validateFiles(newFiles);\n    }\n\n    // Call onFilesSelected callback\n    onFilesSelected?.(newFiles);\n  };\n\n  // Get appropriate icon for file type\n  const getFileIcon = (file: File) => {\n    if (file.type.startsWith('image/')) {\n      return <Image weight=\"regular\" className=\"h-5 w-5\" />;\n    } else if (file.type.startsWith('video/')) {\n      return <FileVideo weight=\"regular\" className=\"h-5 w-5\" />;\n    } else if (file.type.startsWith('audio/')) {\n      return <FileAudio weight=\"regular\" className=\"h-5 w-5\" />;\n    } else if (file.type.startsWith('text/') || file.type.includes('pdf')) {\n      return <FileText weight=\"regular\" className=\"h-5 w-5\" />;\n    } else {\n      return <File weight=\"regular\" className=\"h-5 w-5\" />;\n    }\n  };\n\n  // Format file size\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return (\n      Number.parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\n    );\n  };\n\n  // Generate image preview URL\n  const getImagePreview = (file: File) => {\n    if (file.type.startsWith('image/')) {\n      return URL.createObjectURL(file);\n    }\n    return null;\n  };\n\n  return (\n    <div\n      className={cn('group/field grid gap-2', containerClassName)}\n      data-invalid={hasError}\n    >\n      <label\n        htmlFor={id}\n        className={cn(\n          'text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 group-data-[invalid=true]/field:text-destructive',\n          labelVariant === 'muted' && 'text-muted-foreground',\n          labelClassName,\n        )}\n      >\n        {label}\n        {required && <span aria-hidden=\"true\"> *</span>}\n      </label>\n\n      {description && (\n        <p className=\"text-xs text-muted-foreground\">{description}</p>\n      )}\n\n      <div\n        className={cn(\n          'relative cursor-pointer transition-colors',\n          'flex flex-col items-center justify-center gap-2 text-center p-4 rounded-lg',\n          // Default variant with single dashed border\n          variant === 'default' &&\n            'border-2 border-dashed border-muted-foreground/25',\n          variant === 'default' &&\n            'shadow-[0px_1px_1px_rgba(0,0,0,0.03),_0px_3px_6px_rgba(0,0,0,0.02)]',\n\n          // Pill variant with solid border (not dashed)\n          variant === 'pill' &&\n            'bg-muted border border-solid border-transparent rounded-lg',\n          variant === 'pill' && coloredBorder && 'border-primary/30',\n\n          // Dragging state\n          isDragging && 'border-primary/50 bg-primary/5',\n\n          // Error state\n          hasError &&\n            'border-destructive/50 group-data-[invalid=true]/field:border-destructive',\n\n          // Disabled state\n          (disabled || pending) && 'opacity-60 cursor-not-allowed',\n\n          dropzoneClassName,\n        )}\n        onDragEnter={handleDragEnter}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n        onClick={() => !disabled && !pending && fileInputRef.current?.click()}\n        aria-invalid={hasError}\n        aria-errormessage={hasError ? errorId : undefined}\n        aria-describedby={hint ? hintId : undefined}\n      >\n        <input\n          ref={fileInputRef}\n          id={id}\n          name={name}\n          type=\"file\"\n          accept={accept}\n          multiple={multiple}\n          disabled={disabled || pending}\n          className=\"sr-only\"\n          onChange={handleFileChange}\n          aria-required={required}\n        />\n\n        <CloudArrowUp\n          weight=\"regular\"\n          className=\"h-10 w-10 text-muted-foreground/70\"\n        />\n\n        <div className=\"space-y-1\">\n          <p className=\"text-md font-medium text-foreground\">\n            {dropzoneText || (\n              <>\n                <span className=\"text-primary\">Click to upload</span> or drag\n                and drop\n              </>\n            )}\n          </p>\n          <p className=\"text-xs text-muted-foreground\">\n            {multiple\n              ? `Upload up to ${maxFiles} file${maxFiles !== 1 ? 's' : ''}`\n              : 'Upload a file'}\n            {accept && ` (${accept.replace(/,/g, ', ')})`}\n            {maxSize && ` up to ${formatFileSize(maxSize)}`}\n          </p>\n        </div>\n      </div>\n\n      {/* File previews */}\n      {showPreviews && files.length > 0 && (\n        <div className=\"mt-2 space-y-2\">\n          {files.map((file, index) => {\n            const imagePreview = getImagePreview(file);\n\n            return (\n              <div\n                key={`${file.name}-${index}`}\n                className={cn(\n                  'flex items-center justify-between p-2',\n                  variant === 'pill'\n                    ? 'bg-muted rounded-lg'\n                    : 'bg-muted/50 border border-border rounded',\n                )}\n              >\n                <div className=\"flex items-center gap-2 overflow-hidden\">\n                  {showIcons && (\n                    <div className=\"flex-shrink-0 text-muted-foreground\">\n                      {getFileIcon(file)}\n                    </div>\n                  )}\n\n                  {imagePreview && (\n                    <div className=\"h-10 w-10 rounded overflow-hidden flex-shrink-0 bg-background\">\n                      <img\n                        src={imagePreview || '/placeholder.svg'}\n                        alt={file.name}\n                        className=\"h-full w-full object-cover\"\n                      />\n                    </div>\n                  )}\n\n                  <div className=\"min-w-0 flex-1\">\n                    <p className=\"text-md font-medium truncate\">{file.name}</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {formatFileSize(file.size)}\n                    </p>\n                  </div>\n                </div>\n\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-8 w-8 rounded-full flex-shrink-0 transition-none hover:bg-transparent\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    removeFile(index);\n                  }}\n                  disabled={disabled || pending}\n                  aria-label={`Remove ${file.name}`}\n                >\n                  <X weight=\"regular\" className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {hint && !hasError && (\n        <p id={hintId} className=\"text-xs text-muted-foreground mt-1\">\n          {hint}\n        </p>\n      )}\n\n      {hasError && (\n        <p id={errorId} className=\"text-destructive text-xs\">\n          {localError || error}\n        </p>\n      )}\n    </div>\n  );\n}\n",
      "type": "registry:component",
      "target": "delta/forms/file-input.tsx"
    },
    {
      "path": "delta/forms/file-input-demo.tsx",
      "content": "'use client';\n\nimport { FileInput } from './file-input';\nimport { z } from 'zod';\n\n// Define a schema for file validation\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\nconst ACCEPTED_IMAGE_TYPES = [\n  'image/jpeg',\n  'image/jpg',\n  'image/png',\n  'image/webp',\n];\n\nconst imageSchema = z.instanceof(File).superRefine((file, ctx) => {\n  if (file.size > MAX_FILE_SIZE) {\n    ctx.addIssue({\n      code: z.ZodIssueCode.custom,\n      message: `File size must be less than 5MB`,\n    });\n  }\n\n  if (!ACCEPTED_IMAGE_TYPES.includes(file.type)) {\n    ctx.addIssue({\n      code: z.ZodIssueCode.custom,\n      message: `Only JPEG, PNG and WebP images are accepted`,\n    });\n  }\n});\n\nexport default function FileInputDemo() {\n  return (\n    <div className=\"container mx-auto max-w-7xl px-4 py-8 space-y-8\">\n      <DefaultFileInputDemo />\n      <PillFileInputDemo />\n      <ValidationFileInputDemo />\n      <MutedLabelFileInputDemo />\n      <RequiredFileInputDemo />\n      <DisabledFileInputDemo />\n      <HintFileInputDemo />\n      <MultipleFilesDemo />\n    </div>\n  );\n}\n\nexport function DefaultFileInputDemo() {\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">Default File Input</h2>\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <FileInput label=\"Profile Picture\" name=\"profile\" accept=\"image/*\" />\n        <FileInput label=\"Resume\" name=\"resume\" accept=\".pdf,.doc,.docx\" />\n      </div>\n    </div>\n  );\n}\n\nexport function PillFileInputDemo() {\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">Pill Variant</h2>\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <FileInput\n          label=\"Avatar\"\n          name=\"avatar\"\n          accept=\"image/*\"\n          variant=\"pill\"\n        />\n        <FileInput\n          label=\"Document\"\n          name=\"document\"\n          accept=\".pdf,.doc,.docx\"\n          variant=\"pill\"\n          coloredBorder\n        />\n      </div>\n    </div>\n  );\n}\n\nexport function ValidationFileInputDemo() {\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">With Validation</h2>\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <FileInput\n          label=\"Profile Image\"\n          name=\"profile-validation\"\n          accept=\"image/jpeg,image/png,image/webp\"\n          maxSize={MAX_FILE_SIZE}\n          error=\"Please upload a valid image file (JPEG, PNG, WebP) under 5MB\"\n          schema={imageSchema}\n        />\n        <FileInput\n          label=\"Document\"\n          name=\"document-validation\"\n          accept=\".pdf\"\n          maxSize={2 * 1024 * 1024}\n          error=\"Please upload a PDF file under 2MB\"\n          variant=\"pill\"\n        />\n      </div>\n    </div>\n  );\n}\n\nexport function MutedLabelFileInputDemo() {\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">Muted Label Variant</h2>\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <FileInput\n          label=\"Upload Image\"\n          name=\"image-muted\"\n          accept=\"image/*\"\n          labelVariant=\"muted\"\n        />\n        <FileInput\n          label=\"Upload Document\"\n          name=\"document-muted\"\n          accept=\".pdf,.doc,.docx\"\n          labelVariant=\"muted\"\n          variant=\"pill\"\n        />\n      </div>\n    </div>\n  );\n}\n\nexport function RequiredFileInputDemo() {\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">Required Fields</h2>\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <FileInput\n          label=\"ID Document\"\n          name=\"id-document\"\n          accept=\".pdf,.jpg,.jpeg,.png\"\n          required\n        />\n        <FileInput\n          label=\"Proof of Address\"\n          name=\"proof-address\"\n          accept=\".pdf,.jpg,.jpeg,.png\"\n          required\n          variant=\"pill\"\n        />\n      </div>\n    </div>\n  );\n}\n\nexport function DisabledFileInputDemo() {\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">Disabled State</h2>\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <FileInput\n          label=\"Verification Document\"\n          name=\"verification\"\n          accept=\".pdf,.jpg,.jpeg,.png\"\n          disabled\n        />\n        <FileInput\n          label=\"Additional Documents\"\n          name=\"additional-docs\"\n          accept=\".pdf,.doc,.docx\"\n          disabled\n          variant=\"pill\"\n        />\n      </div>\n    </div>\n  );\n}\n\nexport function HintFileInputDemo() {\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">With Hint Text</h2>\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <FileInput\n          label=\"Profile Picture\"\n          name=\"profile-hint\"\n          accept=\"image/*\"\n          hint=\"Upload a clear photo of your face. Max 5MB.\"\n        />\n        <FileInput\n          label=\"Resume\"\n          name=\"resume-hint\"\n          accept=\".pdf,.doc,.docx\"\n          hint=\"PDF or Word documents only. Max 10MB.\"\n          variant=\"pill\"\n        />\n      </div>\n    </div>\n  );\n}\n\nexport function MultipleFilesDemo() {\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">Multiple Files Upload</h2>\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <FileInput\n          label=\"Photo Gallery\"\n          name=\"gallery\"\n          accept=\"image/*\"\n          multiple\n          maxFiles={5}\n          hint=\"Upload up to 5 images\"\n        />\n        <FileInput\n          label=\"Supporting Documents\"\n          name=\"supporting-docs\"\n          accept=\".pdf,.doc,.docx\"\n          multiple\n          maxFiles={3}\n          hint=\"Upload up to 3 documents\"\n          variant=\"pill\"\n        />\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component",
      "target": "delta/forms/file-input-demo.tsx"
    }
  ]
}